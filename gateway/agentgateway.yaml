# agentgateway configuration
#
# MCP multiplexer with JWT validation.
# Replace YOUR_TAILNET with your actual Tailnet name.
#
# Deploy to: /mnt/user/appdata/agentgateway/config.yaml
# JWKS file: /mnt/user/appdata/agentgateway/jwks.json
#
# Fetch JWKS from Authelia:
#   curl -s https://mcp-gateway.YOUR_TAILNET.ts.net/jwks.json > jwks.json
#
# NOTE: Using permissive mode because Claude.ai doesn't request an audience
# in the OAuth flow, so the JWT has no audience claim. Permissive mode still
# validates issuer and signature, just allows missing/invalid audience.

config:
  adminAddr: "[::]:15000"

binds:
- port: 8080
  listeners:
  - routes:
    - policies:
        cors:
          allowOrigins:
            - "https://claude.ai"
            - "https://claude.com"
            - "https://api.anthropic.com"
          allowHeaders:
            - "Authorization"
            - "Content-Type"
            - "Accept"
            - "X-Requested-With"
          allowMethods:
            - "GET"
            - "POST"
            - "OPTIONS"
        jwtAuth:
          # permissive: validates token if present, continues on failure
          # strict: requires valid token (fails on audience mismatch)
          mode: permissive
          issuer: "https://mcp-gateway.YOUR_TAILNET.ts.net"
          audiences:
            - "https://mcp-gateway.YOUR_TAILNET.ts.net"
            - "claude-mcp-client"
          jwks:
            file: /etc/agentgateway/jwks.json
      backends:
      - mcp:
          targets:
          - name: disney
            mcp:
              host: http://mouse-mcp:3000/mcp
          # Add more MCP backends:
          # - name: obsidian
          #   mcp:
          #     host: http://obsidian:3002/mcp
          # - name: media-metadata
          #   mcp:
          #     host: http://media-mcp:3000/mcp
